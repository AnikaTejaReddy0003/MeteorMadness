<!-- apod/templates/apod.html -->
{% extends 'base.html' %}
{% block title %}APOD{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/apod.css') }}">
{% endblock %}

{% block content %}
    <section class="apod">
        <h1>{{ title or "Astronomy Picture of the Day" }}</h1>

        {% if errors and errors|length %}
            <div class="alert" role="status">
                {% for m in errors %}
                    <div>{{ m }}</div>{% endfor %}
            </div>
        {% endif %}

        <div class="controls">
            <label for="apod-date">Pick date:</label>
            <input
                    type="date"
                    id="apod-date"
                    name="date"
                    value="{{ request.args.get('date', date) }}"
                    max="{{ max_date }}"
            />
        </div>

        {% if date %}
            <div class="meta">Date: {{ date }}</div>{% endif %}
        {% if copyright %}
            <div class="meta">Â© {{ copyright|trim }}</div>
        {% endif %}

        <div class="media">
            {% if media_type == "image" and url %}
                <img src="{{ url }}" alt="{{ title or 'APOD' }}">
                {% if hdurl %}
                    <div class="hd"><a href="{{ hdurl }}" target="_blank" rel="noopener">View HD image</a></div>
                {% endif %}
            {% elif media_type == "video" and url %}
                <div class="video">
                    <iframe src="{{ url }}" allowfullscreen loading="lazy" title="{{ title or 'APOD' }}"></iframe>
                </div>
            {% elif url %}
                <div class="hd"><a href="{{ url }}" target="_blank" rel="noopener">Open content</a></div>
            {% else %}
                <div class="meta">No media available.</div>
            {% endif %}
        </div>

        {% if explanation %}
            <div class="explanation">{{ explanation }}</div>{% endif %}
    </section>

    <script>
        document.getElementById('apod-date').addEventListener('change', function () {
            const selectedDate = this.value;
            window.location.href = `{{ url_for('apod.apod') }}?date=${selectedDate}`;
        });
    </script>
{% endblock %}